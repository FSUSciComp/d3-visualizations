<!DOCTYPE html>
<meta charset="utf-8">
<head>
<script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>

<div id='top'>
<p>
This example is an investigation into the <b>enter, update, and exit</b> coding practice in d3.
<br>For each value in our existing data array we add append a div with the value of the array and the status of the div.
<br>When we hit the <i>push</i> button we push another number onto the array and add it to the DOM which appends it to the div as an <b>enter</b> element.
<br><i>Pop</i> will remove the last element from the array and DOM. This moves that element to the <b>exit</b> context. 
<br>In the blue text we see the status of all the values of the array: which ones are new, which have been changed, and which have exited.
<br>Hopefully this example can be used as a simple starting point for more complicated projects using update, enter, and exit.
</p>
</div>
<div id='console'></div>
<div id='chart'></div>
<input type="button" value="Push" onClick="toggle(1)">
<input type="button" value="Pop" onClick="toggle(-1)">
<script>

var chart = d3.select('#chart');
var console_output = d3.select('#console');
var keyFn = function(d) { return d; };

var dataset = [0, 1, 2]

var divs = chart.selectAll('div')
    .data(dataset, keyFn);

		divs
		.enter()
	  .append('div')
    .text(function(d) { return d + ' - exisiting'; });

function toggle(pushpop){

		//dataset.shift();
		if(pushpop==1){
			dataset.push(dataset.length);
		}
		else{
			dataset.pop();
		}


		//dataset = [0,2];

		//console.log(dataset);

		var divs = chart.selectAll('div')
    	.data(dataset, keyFn);

		var consolelog = console_output.selectAll('div')
		.data([0]);


		console.log("enter:"+divs.enter().data());
		console.log("update:"+divs.data());
		console.log("exit:"+divs.exit().data());

		var consoleout = "";

		consoleout += "enter:"+divs.enter().data();
		consoleout += "; update:"+divs.data();
		consoleout += "; exit:"+divs.exit().data();

		consolelog
		.enter()
		.append('div')
		.text(consoleout)
		.style('color','steelblue');

		consolelog
		.text(consoleout);

		divs
			.style('color', 'green')
	    .text(function(d) { return d + ' - exisiting'; });

		divs
			.enter().append('div')
			.text(function (d) { return d+ ' - new';})
			.style('color','red');


		divs.exit()
	    .style('color', 'grey')
	    .text('deleted')
			.remove();
}
</script>

</body>


</html>
